<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RiccoRide - Manage Trips</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸš— RiccoRide - Manage Trips</h1>
            <nav>
                <a href="index.html">Dashboard</a>
                <a href="trip-entry.html" class="nav-action">+ Add Trip</a>
                <a href="trips-list.html" class="active">Manage Trips</a>
                <a href="manage-data.html">Manage Data</a>
                <a href="reports.html">Reports</a>
            </nav>
        </header>

        <main>
            <!-- Filters -->
            <div class="form-container">
                <h2>Filter Trips</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="filterStartDate">Start Date</label>
                        <input type="date" id="filterStartDate">
                    </div>
                    <div class="form-group">
                        <label for="filterEndDate">End Date</label>
                        <input type="date" id="filterEndDate">
                    </div>
                    <div class="form-group">
                        <label for="filterTripType">Trip Type</label>
                        <select id="filterTripType">
                            <option value="">All Types</option>
                            <option value="Company">Company</option>
                            <option value="Individual">RiccoRide</option>
                            <option value="Outsource">Outsource</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterVehicle">Vehicle</label>
                        <select id="filterVehicle">
                            <option value="">All Vehicles</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                        <button class="btn btn-secondary" onclick="clearFilters()">Clear Filters</button>
                    </div>
                </div>
            </div>

            <!-- Trips Table -->
            <div class="form-container">
                <h2>All Trips</h2>
                <div class="table-container">
                    <table id="tripsTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Route</th>
                                <th>Type</th>
                                <th>Vehicle</th>
                                <th>Driver</th>
                                <th>Company</th>
                                <th>Distance (KM)</th>
                                <th>Payment (â‚¹)</th>
                                <th>Profit (â‚¹)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Edit Trip Modal -->
    <div id="editTripModal" class="modal">
        <div class="modal-content" style="width: 90%; max-width: 800px;">
            <span class="close" onclick="closeTripModal()">&times;</span>
            <h2>Edit Trip</h2>
            <form id="editTripForm">
                <div class="form-grid">
                    <!-- Basic Trip Details -->
                    <div class="form-group">
                        <label for="editTripDate">Trip Date *</label>
                        <input type="date" id="editTripDate" required>
                    </div>

                    <div class="form-group">
                        <label for="editTripType">Trip Type *</label>
                        <select id="editTripType" required onchange="handleEditTripTypeChange()">
                            <option value="">Select Trip Type</option>
                            <option value="Company">Company</option>
                            <option value="Individual">RiccoRide</option>
                            <option value="Outsource">Outsource</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editRoute">Route *</label>
                        <input type="text" id="editRoute" required placeholder="e.g., Mumbai to Pune">
                    </div>

                    <div class="form-group">
                        <label for="editRouteType">Route Type *</label>
                        <select id="editRouteType" required>
                            <option value="">Select Type</option>
                            <option value="Local">Local</option>
                            <option value="Outstation">Outstation</option>
                        </select>
                    </div>

                    <!-- Vehicle Selection -->
                    <div class="form-group" id="editVehicleGroup">
                        <label for="editVehicleId">Vehicle *</label>
                        <select id="editVehicleId" required onchange="handleEditVehicleChange()">
                            <option value="">Select Vehicle</option>
                        </select>
                    </div>

                    <div class="form-group" id="editManualVehicleGroup" style="display: none;">
                        <label for="editManualVehicle">Vehicle Details (Manual Entry) *</label>
                        <input type="text" id="editManualVehicle" placeholder="Enter vehicle details">
                    </div>

                    <!-- Driver Selection -->
                    <div class="form-group">
                        <label for="editDriverId">Driver *</label>
                        <select id="editDriverId" required>
                            <option value="">Select Driver</option>
                        </select>
                    </div>

                    <!-- Company Selection -->
                    <div class="form-group" id="editCompanyGroup" style="display: none;">
                        <label for="editCompanyId">Company *</label>
                        <select id="editCompanyId">
                            <option value="">Select Company</option>
                        </select>
                    </div>

                    <!-- Vendor Selection -->
                    <div class="form-group" id="editVendorGroup" style="display: none;">
                        <label for="editVendorId">Vendor *</label>
                        <select id="editVendorId">
                            <option value="">Select Vendor</option>
                        </select>
                    </div>

                    <!-- Distance and Costs -->
                    <div class="form-group">
                        <label for="editKilometre">Distance (KM) *</label>
                        <input type="number" id="editKilometre" required placeholder="0" min="0" step="0.1">
                    </div>

                    <div class="form-group">
                        <label for="editFuelCost">Fuel Cost (â‚¹) *</label>
                        <input type="number" id="editFuelCost" required placeholder="0" min="0" step="0.01">
                    </div>

                    <!-- Payment Details -->
                    <div class="form-group">
                        <label for="editPaymentMethod">Payment Method *</label>
                        <select id="editPaymentMethod" required>
                            <option value="">Select Payment Method</option>
                            <option value="Online">Online</option>
                            <option value="Cash">Cash</option>
                            <option value="UPI">UPI</option>
                            <option value="Card">Card</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editPayment">Payment Amount (â‚¹) *</label>
                        <input type="number" id="editPayment" required placeholder="0" min="0" step="0.01">
                    </div>

                    <!-- Costs -->
                    <div class="form-group">
                        <label for="editDriverCost">Driver Cost (â‚¹) *</label>
                        <input type="number" id="editDriverCost" required placeholder="0" min="0" step="0.01">
                    </div>

                    <div class="form-group">
                        <label for="editMaintenance">Maintenance Cost (â‚¹)</label>
                        <input type="number" id="editMaintenance" placeholder="0" min="0" step="0.01" value="0">
                    </div>

                    <div class="form-group">
                        <label for="editMaintenanceReason">Maintenance Reason</label>
                        <input type="text" id="editMaintenanceReason" placeholder="Reason for maintenance cost">
                    </div>

                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="editDescription">Trip Description</label>
                        <textarea id="editDescription" rows="3" placeholder="Additional notes about this trip (optional)"></textarea>
                    </div>
                </div>

                <!-- Company Trip Specific Fields -->
                <div id="editCompanyFields" style="display: none;">
                    <h3>Company Trip Details</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editTollParking">Toll & Parking (â‚¹)</label>
                            <input type="number" id="editTollParking" placeholder="0" min="0" step="0.01" value="0">
                        </div>

                        <div class="form-group">
                            <label for="editStartDateTime">Start Date & Time</label>
                            <input type="datetime-local" id="editStartDateTime">
                        </div>

                        <div class="form-group">
                            <label for="editEndDateTime">End Date & Time</label>
                            <input type="datetime-local" id="editEndDateTime" onchange="calculateEditTotalDays()">
                        </div>

                        <div class="form-group">
                            <label for="editTotalDays">Total Days</label>
                            <input type="number" id="editTotalDays" readonly placeholder="Auto calculated" step="0.1">
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-grid">
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Update Trip</button>
                        <button type="button" class="btn btn-secondary" onclick="closeTripModal()">Cancel</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- View Trip Modal -->
    <div id="viewTripModal" class="modal">
        <div class="modal-content" style="width: 90%; max-width: 700px;">
            <span class="close" onclick="closeViewModal()">&times;</span>
            <h2>Trip Details</h2>
            <div id="tripDetails"></div>
        </div>
    </div>

    <!-- Supabase Database (simplified) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/storage-database.js"></script>
    
    <script src="js/trips-list.js"></script>
</body>
</html>